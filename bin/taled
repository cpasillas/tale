#!/usr/bin/env python

# get bearings
import sys
from os.path import join, dirname, realpath
ROOTDIR = realpath(join(dirname(__file__), '..'))

# arrange for tale libraries to be available
LIBDIR = join(ROOTDIR, 'lib')
sys.path.insert(0, LIBDIR)

# double fork, divorce session, write pid file, deescalate user privs
from daemon import daemon
@daemon(
    user = 'www-data',
    pidfile = join(ROOTDIR, 'var', 'run', 'taled.pid'),
    logfile = join(ROOTDIR, 'var', 'log', 'taled', 'status.log'),
    errorfile = join(ROOTDIR, 'var', 'log', 'taled', 'error.log'),
)
def daemonized():
    # run the daemon
    from tale.taled import taled
    taled()

